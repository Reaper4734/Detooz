============================= test session starts =============================
platform win32 -- Python 3.13.3, pytest-9.0.2, pluggy-1.6.0
rootdir: C:\CP\plans\Detooz\backend
configfile: pytest.ini
plugins: anyio-4.12.1, asyncio-1.3.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 13 items

tests\test_services.py ...........FF                                     [100%]

================================== FAILURES ===================================
_________________ TestTraiLogic.test_trai_marketing_exception _________________

self = <test_services.TestTraiLogic object at 0x0000016E76D98550>

    @pytest.mark.asyncio
    async def test_trai_marketing_exception(self):
        """Test that TRAI regulated sender marketing is downgraded to LOW risk"""
        # "Loan approved" is usually HIGH risk (loan_scam)
        # But from a TRAI header it should be treated as Marketing (LOW)
        result = await self.detector.analyze_quick(
            "Dear customer, your personal loan of 500000 is approved. Apply now.",
            sender="AD-HDFCBK"
        )
        assert result["risk_level"] == "LOW"
>       assert result["scam_type"] == "Marketing/Spam"
E       AssertionError: assert None == 'Marketing/Spam'

tests\test_services.py:123: AssertionError
______________________ TestTraiLogic.test_non_trai_scam _______________________

self = <test_services.TestTraiLogic object at 0x0000016E76D98690>

    @pytest.mark.asyncio
    async def test_non_trai_scam(self):
        """Test that non-TRAI sender sending same message is HIGH risk"""
        result = await self.detector.analyze_quick(
            "Dear customer, your personal loan of 500000 is approved. Apply now.",
            sender="9876543210"
        )
        # Normal loan scam is HIGH or MEDIUM depending on patterns, but definitely not verified LOW
>       assert result["risk_level"] == "HIGH"
E       AssertionError: assert 'LOW' == 'HIGH'
E         
E         - HIGH
E         + LOW

tests\test_services.py:141: AssertionError
============================== warnings summary ===============================
app\services\scam_detector.py:15
  C:\CP\plans\Detooz\backend\app\services\scam_detector.py:15: FutureWarning: 
  
  All support for the `google.generativeai` package has ended. It will no longer be receiving 
  updates or bug fixes. Please switch to the `google.genai` package as soon as possible.
  See README for more details:
  
  https://github.com/google-gemini/deprecated-generative-ai-python/blob/main/README.md
  
    import google.generativeai as genai

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/test_services.py::TestTraiLogic::test_trai_marketing_exception
FAILED tests/test_services.py::TestTraiLogic::test_non_trai_scam - AssertionE...
=================== 2 failed, 11 passed, 1 warning in 0.72s ===================
